# Time Zones

Note that IANA time zone support is implemented via the Intl API to keep actual time zone data out of 
code bundles. Modern browsers all support the 
[necessary features](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DateTimeFormat#Browser_compatibility),
but for those that don't, most notably IE (it is supported in Edge), you will need a 
[polyfill](https://github.com/yahoo/date-time-format-timezone).

If you do not wish to use a polyfill the time zone functions / option can still be used, but only with
time zone offsets such as '-0200' or '+04:00'.

## Table of Contents

- [Overview](#usage)

- [Time Zone Helpers](#time-zone-helpers)

    - [`setTimeZone` - Get a date (UTC time) of a date/time in a specific time zone](#settimezone)
    
    - [`dateAtTimeZone` - Get a date/time in the local time of any time zone](#dateattimezone)

- [Time Zone Formatting](#time-zone-formatting)

    - [Format a date in any local time](#format-a-date-in-any-local-time)

    - [Date creation with IANA time zones](#date-creation-with-iana-time-zones)

## Overview

Programmatic consumption of UTC or ISO strings are easy, and so is working with JS dates when all times
are displayed in a user's local time in the browser. The difficulty comes when working with another 
time zone's local time other than the current system's, like on a Node server or when showing the time 
of an event in a specific time zone, like an event in LA at 8pm PST regardless of where a user resides.

In this case there are two relevant pieces of information: 
 - a fixed moment in time in the form of a timestamp, UTC or ISO date string, and
 - the time zone descriptor, usually an offset or IANA time zone name (e.g. `America/New_York`).

Libraries like Moment and Luxon, which provides their own date time classes, manage these timestamp and time 
zone values internally. Sine `date-fns` always returns a plain JS Date, which implicitly has the current 
system's time zone, helper functions are provided for handling common time zone related use cases. 

## Time Zone Helpers

To discuss the usage of the time zone helpers let's assume we're writing a system where administrators set
up events which will be held at a specific time at the venue's local time all over the world.

### `setTimeZone`

**Get a date (UTC time) of a date/time in a specific time zone**

Say a user is asked to input the date/time and time zone of an event. A date/time picker will typically 
return a Date instance with the chosen date, in the user's local time zone, and a select input might 
provide the actual IANA time zone name. 

In order to work with this info it is necessary to find the equivalent "fixed point" or UTC time:

```javascript
import {setTimeZone} from 'date-fns'

const date = getDatePickerValue()     // e.g. 2014-06-25 10:00:00 (picked in any time zone) 
const timeZone = getTimeZoneValue()   // e.g. America/Los_Angeles

const zoned = setTimeZone(date, timeZone)   // In June 10am in Los Angeles is 5pm UTC

postToServer(zoned.toISOString(), timeZone) // post 2014-06-25T17:00:00.000Z, America/Los_Angeles
```

### `dateAtTimeZone`

**Get a date/time in the local time of any time zone**

Say the server provided a UTC time and a time zone which should be used as initial values for the above form.
The date/time picker will take a Date input which will be in the user's local time zone, but the date value 
must be that of the target time zone.

```javascript
import {dateAtTimeZone} from 'date-fns'

const {isoDate, timeZone} = fetchInitialValues()  // 2014-06-25T10:00:00.000Z, America/New_York

const date = dateAtTimeZone(isoDate, timeZone)    // In June 10am UTC is 6am in New York (-04:00)

renderDatePicker(date)          // 2014-06-25 06:00:00 (in the system time zone)
renderTimeZoneSelect(timeZone)  // America/New_York
```

## Time Zone Formatting

### Format a date in any local time

When listing events you may want to display the date/time local to the time zone of the event. The `format`
function supports this via the `timeZone` option. Use the `ZZZ` token to display the short name of the 
time zone rather than an offset.

```javascript
import {format} from 'date-fns'

const date = new Date('2014-10-25T10:46:20Z')

format(date, 'YYYY-MM-DD HH:mm:ssZ', {timeZone: 'America/New_York'})    // 2014-10-25 06:46:20-04:00
format(date, 'YYYY-MM-DD HH:mm:ss ZZZ', {timeZone: 'America/New_York'}) // 2014-10-25 06:46:20 EST
format(date, 'YYYY-MM-DD HH:mm:ss ZZZ', {timeZone: 'Europe/Paris'})     // 2014-10-25 10:46:20 GMT+2

// Time zone name is generated by the Intl API which works best when a locale is also specified
import enGB from 'date-fns/locale/en-GB'
format(date, 'YYYY-MM-DD HH:mm:ss ZZZ', {timeZone: 'Europe/Paris', locale: enGB}) // 2014-10-25 10:46:20 CET
```

`format` uses `dateAtTimeZone` under the hood to convert ISO strings and Date instances before formatting.

### Date creation with IANA time zones

A Date with a date/time expressed in a specific time zone can be created using the `toDate` function by
providing the `timeZone` option or including an IANA time zone in the string.

When using the `parse` function the `ZZZZ` token can be used to parse IANA time zones.

```javascript
import {toDate, parse, format} from 'date-fns'

// Offsets in the date string work as usual and take precedence
const withOffset = toDate('2014-10-25T13:46:20+02:00')
format(withOffset, 'YYYY-MM-DD HH:mm:ssZ', {timeZone: 'Europe/Paris'}) // 2014-10-25 13:46:20+02:00

// Since toDate simply clones Date objects the timeZone option is effectively ignored
const date = new Date('2014-10-25T13:46:20Z')
const clonedDate = toDate(date, {timeZone: 'Europe/Paris'})
date.valueOf() === clonedDate.valueOf()

// Note there is no offset in the date string
const tzOption = toDate('2014-10-25T13:46:20', {timeZone: 'Asia/Bangkok'})
format(tzOption, 'YYYY-MM-DD HH:mm:ssZ', {timeZone: 'Asia/Bangkok'}) // 2014-10-25 13:46:20+07:00

const tzInDateStr = toDate('2014-10-25T13:46:20 America/New_York')
format(tzInDateStr, 'YYYY-MM-DD HH:mm:ssZ', {timeZone: 'America/New_York'}) // 2014-10-25 13:46:20-04:00

const parsed = parse('2014/10/25 12 pm America/New_York', 'YYYY/MM/DD hh a ZZZZ', new Date())
format(parsed, 'YYYY-MM-DD HH:mm:ssZ', {timeZone: 'America/New_York'}) // 2014-10-25 12:00:00-04:00
```
